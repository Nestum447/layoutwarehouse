<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Bodega Visual - 15 Racks</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; background: #f0f0f0; margin:0; padding:10px; }
h2 { text-align:center; margin-bottom: 10px; }
#bodega { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
.rack { display:grid; grid-template-columns: repeat(23, 30px); grid-auto-rows: 30px; gap:2px; border:1px solid #333; padding:5px; background:#fff; }
.rack-title { grid-column: span 23; text-align:center; font-weight:bold; margin-bottom:5px; }
.subcuadro { display:flex; align-items:center; justify-content:center; font-size:10px; cursor:pointer; user-select:none; background:#ddd; border:1px solid #aaa; }
.subcuadro.ocupado { background:#ff4d4d; }
.subcuadro.seleccionado { background:#4caf50; color:white; }
.rack-summary { grid-column: span 23; font-size:12px; margin-top:3px; text-align:center; }
#info { margin:10px; font-weight:bold; text-align:center; }
button { display:block; margin:10px auto; padding:5px 10px; font-size:14px; }
pre { background:#eee; padding:10px; max-height:300px; overflow:auto; margin:10px; }
</style>
</head>
<body>

<h2>Bodega Visual - 15 Racks</h2>
<div id="bodega"></div>
<div id="info">
  Total sub-ubicaciones seleccionadas: <span id="totalSel">0</span> / No seleccionadas: <span id="totalNoSel">0</span>
</div>
<button id="exportBtn">Exportar Distribuci√≥n a JSON</button>
<pre id="exportOutput"></pre>

<script>
const columnas = Array.from({length:23}, (_,i)=>String.fromCharCode(65+i));
const niveles = [1,2,3,4,5,6];
const subUbicaciones = [1,2,3];
const totalRacks = 15;
const maxSubPorRack = 30;

const bodega = document.getElementById("bodega");
let racksData = [];

for(let r=1; r<=totalRacks; r++){
  const rackDiv = document.createElement("div");
  rackDiv.classList.add("rack");

  const rackTitle = document.createElement("div");
  rackTitle.classList.add("rack-title");
  rackTitle.textContent = `Rack ${r}`;
  rackDiv.appendChild(rackTitle);

  let rackInfo = {rack:r, seleccionadas:0, noSeleccionadas:0, subUbicaciones:[]};

  columnas.forEach(col=>{
    niveles.forEach(niv=>{
      subUbicaciones.forEach(sub=>{
        const subDiv = document.createElement("div");
        subDiv.classList.add("subcuadro");
        subDiv.dataset.rack = r;
        subDiv.dataset.col = col;
        subDiv.dataset.niv = niv;
        subDiv.dataset.sub = sub;
        subDiv.title = `Rack${r}-${col}${niv}-S${sub}`;
        subDiv.textContent = sub;

        if(Math.random()<0.05) subDiv.classList.add("ocupado");

        subDiv.addEventListener("click", ()=>{
          const selectedCount = rackDiv.querySelectorAll(".subcuadro.seleccionado").length;
          if(subDiv.classList.contains("ocupado")) return;
          if(!subDiv.classList.contains("seleccionado") && selectedCount>=maxSubPorRack) return;
          subDiv.classList.toggle("seleccionado");
          updateRackSummary(rackDiv, rackInfo);
          updateTotales();
        });

        rackDiv.appendChild(subDiv);
        rackInfo.subUbicaciones.push({col,niv,sub,seleccionado:false,ocupado:subDiv.classList.contains("ocupado")});
      });
    });
  });

  const summaryDiv = document.createElement("div");
  summaryDiv.classList.add("rack-summary");
  rackDiv.appendChild(summaryDiv);

  bodega.appendChild(rackDiv);
  racksData.push({rackInfo,summaryDiv,rackDiv});
  updateRackSummary(rackDiv,rackInfo);
}

function updateRackSummary(rackDiv,rackInfo){
  const sel = rackDiv.querySelectorAll(".subcuadro.seleccionado").length;
  const total = rackDiv.querySelectorAll(".subcuadro").length;
  rackInfo.seleccionadas = sel;
  rackInfo.noSeleccionadas = total - sel;
  rackDiv.querySelector(".rack-summary").textContent = `Seleccionadas: ${sel} / No seleccionadas: ${total - sel}`;
  rackInfo.subUbicaciones.forEach(sub=>{
    const div = rackDiv.querySelector(`.subcuadro[title='Rack${rackInfo.rack}-${sub.col}${sub.niv}-S${sub.sub}']`);
    if(div) sub.seleccionado = div.classList.contains("seleccionado");
  });
}

function updateTotales(){
  const todos = document.querySelectorAll(".subcuadro");
  const sel = document.querySelectorAll(".subcuadro.seleccionado");
  document.getElementById("totalSel").textContent = sel.length;
  document.getElementById("totalNoSel").textContent = todos.length - sel.length;
}

document.getElementById("exportBtn").addEventListener("click", ()=>{
  const exportData = racksData.map(r=>({rack:r.rackInfo.rack,subUbicaciones:r.rackInfo.subUbicaciones}));
  document.getElementById("exportOutput").textContent = JSON.stringify(exportData,null,2);
});

updateTotales();
</script>

</body>
</html>
